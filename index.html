<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå¤©æ°—ã‚¢ãƒ—ãƒª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* å¤©æ°—æƒ…å ±ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«: ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #weather-info {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 0 10px; 
        }

        /* å„éƒ½å¸‚ã®å¤©æ°—ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-weather {
            background-color: #ffffff; 
            border: 1px solid #e0e0e0; 
            padding: 20px;
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
            transition: transform 0.2s ease-in-out; 
        }

        /* ã‚«ãƒ¼ãƒ‰ã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒä¹—ã£ãŸæ™‚ã®åŠ¹æœ */
        .city-weather:hover {
            transform: translateY(-5px);
        }

        /* éƒ½å¸‚åã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        /* å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .weather-icon {
            font-size: 1.5em;
            margin-right: 8px;
            vertical-align: middle;
        }

        /* æ°—æ¸©æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .temp-info span {
            font-weight: 500; 
            color: #e67e22;
        }

        /* ç´°ã‹ã„æƒ…å ± (ç™ºè¡¨æ—¥æ™‚ã€ã‚¨ãƒªã‚¢ã‚³ãƒ¼ãƒ‰) ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-weather div {
             margin-bottom: 8px; 
        }
        small {
            color: #777;
            font-size: 0.85em;
            display: block;
            margin-top: 15px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .error {
            color: #e74c3c;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background-color: #fdeded;
            border: 1px solid #e74c3c;
            border-radius: 5px;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>

    <h1>ä¸»è¦éƒ½å¸‚ã®ãŠå¤©æ°—</h1>

    <div id="weather-info">
        <p>å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

    <script>
        console.log("JavaScriptå®Ÿè¡Œé–‹å§‹");
        const apiUrl = 'http://localhost:8080/api/weather';
        const weatherInfoDiv = document.getElementById('weather-info');

        async function fetchWeather() {
            console.log("å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’é–‹å§‹ã—ã¾ã™:", apiUrl);
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`APIã‹ã‚‰ã®å¿œç­”ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                console.log("å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:", data);
                displayWeather(data);
            } catch (error) {
                console.error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¾ãŸã¯å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                weatherInfoDiv.innerHTML = `<p class="error">å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>${error.message}</p>`;
            }
        }

        // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’HTMLã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayWeather(weatherData) {
            weatherInfoDiv.innerHTML = ''; // è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢

            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º (ã‚ã‚Œã°)
            if (weatherData.lastError) {
                weatherInfoDiv.innerHTML += `<p class="error">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${weatherData.lastError}</p>`;
            }

            if (weatherData.cityWeather && weatherData.cityWeather.length > 0) {
                weatherData.cityWeather.forEach(city => {
                    const cityDiv = document.createElement('div');
                    cityDiv.className = 'city-weather'; // CSSã‚¯ãƒ©ã‚¹ã‚’è¨­å®š

                    let todayIcon = getWeatherIcon(city.todayWeather);
                    let tomorrowIcon = getWeatherIcon(city.tomorrowWeather);

                    // HTMLã®ä¸­èº«ã‚’çµ„ã¿ç«‹ã¦ã‚‹ (ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ )
                    cityDiv.innerHTML = `
                        <div class="city-name">${city.areaName} (${city.tempAreaName || city.areaName})</div>
                        <div><small>ç™ºè¡¨æ—¥æ™‚: ${city.reportTime}</small></div>
                        <div><span class="weather-icon">${todayIcon}</span> ä»Šæ—¥: ${city.todayWeather || 'æƒ…å ±ãªã—'}</div>
                        <div><span class="weather-icon">${tomorrowIcon}</span> æ˜æ—¥: ${city.tomorrowWeather || 'æƒ…å ±ãªã—'}</div>
                        <div class="temp-info">ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©: <span>${city.tempTodayHigh || 'N/A'}â„ƒ</span></div>
                        <div class="temp-info">æ˜æ—¥ã®æœ€ä½æ°—æ¸©: <span>${city.tempTmrwLow || 'N/A'}â„ƒ</span> / æœ€é«˜æ°—æ¸©: <span>${city.tempTmrwHigh || 'N/A'}â„ƒ</span></div>
                    `;
                    // tempAreaName ãŒãªã„å ´åˆ areaName ã‚’è¡¨ç¤ºã€å¤©æ°—ã‚„æ°—æ¸©ãŒãªã„å ´åˆã¯ 'N/A' ã‚„ 'æƒ…å ±ãªã—' ã‚’è¡¨ç¤º

                    weatherInfoDiv.appendChild(cityDiv);
                });
            } else if (!weatherData.lastError) { // ã‚¨ãƒ©ãƒ¼ãŒãªããƒ‡ãƒ¼ã‚¿ã‚‚ãªã„å ´åˆ
                weatherInfoDiv.innerHTML = '<p>è¡¨ç¤ºã§ãã‚‹å¤©æ°—æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            }
        }

        // --- å¤©æ°—æ–‡å­—åˆ—ã‹ã‚‰ç°¡å˜ãªçµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿”ã™é–¢æ•° ---
        function getWeatherIcon(weatherString) {
            if (!weatherString) return 'â“'; // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
            if (weatherString.includes('æ™´ã‚Œ')) {
                if (weatherString.includes('ãã‚‚ã‚Š') || weatherString.includes('æ›‡ã‚Š')) return 'ğŸŒ¤ï¸'; // æ™´ã‚Œæ™‚ã€…ãã‚‚ã‚Š
                return 'â˜€ï¸'; // æ™´ã‚Œ
            } else if (weatherString.includes('é›¨')) {
                 if (weatherString.includes('ãã‚‚ã‚Š') || weatherString.includes('æ›‡ã‚Š')) return 'ğŸŒ¦ï¸'; // ãã‚‚ã‚Šæ™‚ã€…é›¨
                 if (weatherString.includes('é›ª')) return 'ğŸŒ¨ï¸'; // é›¨ã‹é›ª
                return 'ğŸŒ§ï¸'; // é›¨
            } else if (weatherString.includes('ãã‚‚ã‚Š') || weatherString.includes('æ›‡ã‚Š')) {
                return 'â˜ï¸'; // ãã‚‚ã‚Š
            } else if (weatherString.includes('é›ª')) {
                return 'â„ï¸'; // é›ª
            } else if (weatherString.includes('é›·')) {
                return 'âš¡'; // é›·
            } else {
                return 'â“'; // ä¸Šè¨˜ä»¥å¤–ã¯ä¸æ˜
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        fetchWeather();
    </script>

</body>
</html>