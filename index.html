<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠå¤©æ°—ã‚µã‚¤ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* å¤©æ°—æƒ…å ±ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«: ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #weather-info {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 0 10px; 
        }

        /* å„éƒ½å¸‚ã®å¤©æ°—ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-weather {
            background-color: #ffffff; 
            border: 1px solid #e0e0e0; 
            padding: 20px;
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
            transition: transform 0.2s ease-in-out; 
        }

        /* ã‚«ãƒ¼ãƒ‰ã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒä¹—ã£ãŸæ™‚ã®åŠ¹æœ */
        .city-weather:hover {
            transform: translateY(-5px);
        }

        /* éƒ½å¸‚åã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        /* å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .weather-icon {
            font-size: 1.5em;
            margin-right: 8px;
            vertical-align: middle;
        }

        /* æ°—æ¸©æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .temp-info span {
            font-weight: 500; 
            color: #e67e22;
        }

        /* ç´°ã‹ã„æƒ…å ± (ç™ºè¡¨æ—¥æ™‚ã€ã‚¨ãƒªã‚¢ã‚³ãƒ¼ãƒ‰) ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .city-weather div {
             margin-bottom: 8px; 
        }
        small {
            color: #777;
            font-size: 0.85em;
            display: block;
            margin-top: 15px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .error {
            color: #e74c3c;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            background-color: #fdeded;
            border: 1px solid #e74c3c;
            border-radius: 5px;
            grid-column: 1 / -1;
        }

        #refresh-button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #refresh-button:hover {
            background-color: #0056b3;
        }
        #refresh-button:active {
            background-color: #004085;
        }

        .loading-message {
            text-align: center;
            font-style: italic;
            color: #555;
            padding: 20px;
            grid-column: 1 / -1;
        }
        #weather-detail-modal {
            width: 85%;
            max-width: 550px;
            padding: 25px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.25);
            /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒ <dialog> ã‚¿ã‚°ã®æ©Ÿèƒ½ã§ä¸­å¤®è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã«å‚™ãˆã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§æ®‹ã™ */
            /* position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); */
        }

        /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºæ™‚ã®èƒŒæ™¯ã‚’å°‘ã—æš—ãã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
        #weather-detail-modal::backdrop {
            background-color: rgba(0, 0, 0, 0.6);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®è¦‹å‡ºã— (éƒ½å¸‚å) */
        #modal-city-name {
            margin-top: 0;
            margin-bottom: 15px;
            color: #3498db;
            font-size: 1.6em;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #modal-content {
            margin-top: 20px;
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
            line-height: 1.6;
        }
        /* è©³ç´°æƒ…å ±å†…ã®å„è¡Œã®ã‚¹ã‚¿ã‚¤ãƒ« (ä¾‹) */
        #modal-content p {
             margin-bottom: 10px;
        }
         #modal-content strong {
             color: #333;
             margin-right: 5px;
         }


        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
        #modal-close-button {
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #modal-close-button:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>

    <h1>ä¸»è¦éƒ½å¸‚ã®ãŠå¤©æ°—</h1>

    <div style="text-align: center; margin-bottom: 20px;">
        <button id="refresh-button">å¤©æ°—æƒ…å ±ã‚’æ›´æ–°</button>

    </div>

    <div id="weather-info">
        <p>å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <dialog id="weather-detail-modal">
            <h2 id="modal-city-name">ï¼ˆéƒ½å¸‚åï¼‰</h2>
            <hr>
            <div id="modal-content">
                <p>è©³ç´°æƒ…å ±ã‚’æº–å‚™ä¸­...</p>
            </div>
            <hr>
            <div style="text-align: right; margin-top: 15px;">
              <button id="modal-close-button" autofocus>é–‰ã˜ã‚‹</button>
            </div>
        </dialog>
        
    <script>
        console.log("JavaScriptå®Ÿè¡Œé–‹å§‹");
        const apiUrl = 'http://localhost:8080/api/weather';
        const weatherInfoDiv = document.getElementById('weather-info');
        const refreshButton = document.getElementById('refresh-button');
        const modal = document.getElementById('weather-detail-modal');
        const modalCityName = document.getElementById('modal-city-name');
        const modalContent = document.getElementById('modal-content');
        const modalCloseButton = document.getElementById('modal-close-button');

        //ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹å¤‰æ•° 
        let allWeatherData = [];

        async function fetchWeather() {
            console.log("å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’é–‹å§‹ã—ã¾ã™:", apiUrl);
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`APIã‹ã‚‰ã®å¿œç­”ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                console.log("å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:", data);
                if (data && data.cityWeather) {
                    allWeatherData = data.cityWeather; // é…åˆ—ã‚’ä¿æŒ
                    console.log('allWeatherData ã«æ ¼ç´:', allWeatherData);
                } else {
                    allWeatherData = []; // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºã«
                }
                displayWeather(data);
            } catch (error) {
                console.error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¾ãŸã¯å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                weatherInfoDiv.innerHTML = `<p class="error">å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>${error.message}</p>`;
            }
        }

        // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’HTMLã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayWeather(weatherData) {
            weatherInfoDiv.innerHTML = ''; // è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢

            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º (ã‚ã‚Œã°)
            if (weatherData.lastError) {
                weatherInfoDiv.innerHTML += `<p class="error">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${weatherData.lastError}</p>`;
            }

            if (allWeatherData && allWeatherData.length > 0) {
                allWeatherData.forEach(city => {
                    console.log('ã‚«ãƒ¼ãƒ‰ç”Ÿæˆä¸­ AreaCode:', city.areaCode);
                    const cityDiv = document.createElement('div');
                    cityDiv.className = 'city-weather'; // CSSã‚¯ãƒ©ã‚¹ã‚’è¨­å®š

                    cityDiv.dataset.areaCode = city.areaCode;
                    cityDiv.addEventListener('click', () => {
                        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰ showModalDetails é–¢æ•°ã‚’å‘¼ã³å‡ºã™
                        showModalDetails(city.areaCode);
                    });

                    let todayIcon = getWeatherIcon(city.todayWeather);
                    let tomorrowIcon = getWeatherIcon(city.tomorrowWeather);

                    // HTMLã®ä¸­èº«ã‚’çµ„ã¿ç«‹ã¦ã‚‹ (ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ )
                    cityDiv.innerHTML = `
                        <div class="city-name">${city.areaName} (${city.tempAreaName || city.areaName})</div>
                        <div><small>ç™ºè¡¨æ—¥æ™‚: ${city.reportTime}</small></div>
                        <div><span class="weather-icon">${todayIcon}</span> ä»Šæ—¥: ${city.todayWeather || 'æƒ…å ±ãªã—'}</div>
                        <div><span class="weather-icon">${tomorrowIcon}</span> æ˜æ—¥: ${city.tomorrowWeather || 'æƒ…å ±ãªã—'}</div>
                        <div class="temp-info">ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©: <span>${city.tempTodayHigh || 'N/A'}â„ƒ</span></div>
                        <div class="temp-info">æ˜æ—¥ã®æœ€ä½æ°—æ¸©: <span>${city.tempTmrwLow || 'N/A'}â„ƒ</span> / æœ€é«˜æ°—æ¸©: <span>${city.tempTmrwHigh || 'N/A'}â„ƒ</span></div>
                    `;
                    // tempAreaName ãŒãªã„å ´åˆ areaName ã‚’è¡¨ç¤ºã€å¤©æ°—ã‚„æ°—æ¸©ãŒãªã„å ´åˆã¯ 'N/A' ã‚„ 'æƒ…å ±ãªã—' ã‚’è¡¨ç¤º

                    weatherInfoDiv.appendChild(cityDiv);
                });
            } else if (!weatherData.lastError) { // ã‚¨ãƒ©ãƒ¼ãŒãªããƒ‡ãƒ¼ã‚¿ã‚‚ãªã„å ´åˆ
                weatherInfoDiv.innerHTML = '<p>è¡¨ç¤ºã§ãã‚‹å¤©æ°—æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            }
        }

        //ãƒ¢ãƒ¼ãƒ€ãƒ«ã«è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showModalDetails(areaCode) {
            console.log("showModalDetails å‘¼ã³å‡ºã— AreaCode:", areaCode);
            console.log("æ¤œç´¢å¯¾è±¡ã® allWeatherData:", allWeatherData);
            const cityData = allWeatherData.find(city => city.areaCode === areaCode);
            console.log("findã®çµæœ cityData:", cityData);
            console.log("è©³ç´°è¡¨ç¤ºãƒªã‚¯ã‚¨ã‚¹ãƒˆ:", areaCode);

           if (cityData && modal) {
                modalCityName.textContent = `${cityData.areaName} (${cityData.tempAreaName || cityData.areaName}) ã®è©³ç´°æƒ…å ±`;

                // --- åŸºæœ¬æƒ…å ±ã®HTMLã‚’çµ„ã¿ç«‹ã¦ ---
                let detailsHtml = `
                    <p><strong>ä»Šæ—¥ã®å¤©æ°—:</strong> ${getWeatherIcon(cityData.todayWeather)} ${cityData.todayWeather || 'æƒ…å ±ãªã—'}</p>
                    <p><strong>æ˜æ—¥ã®å¤©æ°—:</strong> ${getWeatherIcon(cityData.tomorrowWeather)} ${cityData.tomorrowWeather || 'æƒ…å ±ãªã—'}</p>
                    <p><strong>ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©:</strong> ${cityData.tempTodayHigh || 'N/A'}â„ƒ</p>
                    <p><strong>æ˜æ—¥ã®æœ€ä½/æœ€é«˜æ°—æ¸©:</strong> ${cityData.tempTmrwLow || 'N/A'}â„ƒ / ${cityData.tempTmrwHigh || 'N/A'}â„ƒ</p>
                `;

                // é™æ°´ç¢ºç‡(Pops)ãŒã‚ã‚Œã°è¡¨ç¤º
                if (cityData.Pops && cityData.Pops.length > 0) {
                    // æ™‚é–“å¸¯è¡¨ç¤ºã¯çœç•¥ã—ã€å˜ç´”ã«çµåˆ
                    detailsHtml += `<p><strong>é™æ°´ç¢ºç‡ (%):</strong> ${cityData.Pops.join(' - ')}</p>`;
                } else {
                    detailsHtml += `<p><strong>é™æ°´ç¢ºç‡ (%):</strong> æƒ…å ±ãªã—</p>`;
                }

                // é¢¨(Winds)ãŒã‚ã‚Œã°è¡¨ç¤º
                if (cityData.Winds && cityData.Winds.length > 0) {
                    detailsHtml += `<p><strong>é¢¨:</strong> ${cityData.Winds.join(', ')}</p>`; // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¨è¡¨ç¤º
                } else {
                    detailsHtml += `<p><strong>é¢¨:</strong> æƒ…å ±ãªã—</p>`;
                }

                // --- é€±é–“äºˆå ±ã®HTMLã‚’çµ„ã¿ç«‹ã¦ ---
                if (cityData.weeklyForecast && cityData.weeklyForecast.length > 0) {
                    detailsHtml += '<hr><h3>é€±é–“äºˆå ±</h3><div style="display: flex; flex-wrap: wrap; gap: 10px;">'; // Flexboxã§æ¨ªä¸¦ã³

                cityData.weeklyForecast.forEach((wf, index) => {
                const dateObj = new Date(wf.date);
                const dateString = `${dateObj.getMonth() + 1}/${dateObj.getDate()} (${['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][dateObj.getDay()]})`;
                const weatherIcon = getWeatherIcon(wf.weatherCode);

                // --- ä»Šæ—¥ã®æ°—æ¸©è¡¨ç¤ºã‚’èª¿æ•´ ---
                let tempDisplay;
                    if (index === 0) { // æœ€åˆã®è¦ç´ ï¼ˆä»Šæ—¥ï¼‰ã®å ´åˆ
                    // ä»Šæ—¥ã®æœ€é«˜æ°—æ¸©ã¯ cityData ã‹ã‚‰å–å¾—ã€æœ€ä½æ°—æ¸©ã¯ N/A ã¨ã™ã‚‹
                    tempDisplay = `${cityData.tempTodayHigh || 'N/A'}â„ƒ / --â„ƒ`;
                } else { // æ˜æ—¥ä»¥é™ã®å ´åˆ
                    tempDisplay = `${wf.tempMax || 'N/A'}â„ƒ / ${wf.tempMin || 'N/A'}â„ƒ`;
                }

                detailsHtml += `
                    <div style="border: 1px solid #eee; padding: 8px; border-radius: 4px; text-align: center; min-width: 100px;">
                        <div><strong>${dateString} ${index === 0 ? '' : ''}</strong></div>
                        <div style="font-size: 1.5em; margin: 5px 0;">${weatherIcon}</div>
                        <div style="white-space: nowrap;">${tempDisplay}</div>
                        <div><small>é™æ°´: ${wf.pop || '--'}%</small></div>
                        ${wf.reliability ? `<div><small>(ä¿¡é ¼åº¦: ${wf.reliability})</small></div>` : ''}
                    </div>
                `;
            });

            detailsHtml += '</div>';
        } else {
            detailsHtml += '<hr><p>é€±é–“äºˆå ±ã®æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        }
                // --- é€±é–“äºˆå ±ã®HTMLçµ„ã¿ç«‹ã¦ ---


                detailsHtml += `<hr><p><small>ç™ºè¡¨æ—¥æ™‚: ${cityData.reportTime}</small></p>`;

                modalContent.innerHTML = detailsHtml;

                modal.showModal();

            } else {
                console.error("è©³ç´°è¡¨ç¤ºã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ AreaCode:", areaCode);
                alert("è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            }
        }

        //ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        if (modal && modalCloseButton) {
            // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰é–‰ã˜ã‚‹
            modalCloseButton.addEventListener('click', () => {
                modal.close();
            });

            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å¤–å´ (::backdrop) ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰é–‰ã˜ã‚‹
            modal.addEventListener('click', (event) => {
                if (event.target === modal) { // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã®ãŒãƒ€ã‚¤ã‚¢ãƒ­ã‚°è‡ªèº«(å¤–å´)ã‹åˆ¤å®š
                    modal.close();
                }
            });
        } else {
             console.error("ãƒ¢ãƒ¼ãƒ€ãƒ«ã¾ãŸã¯é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚HTMLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }

        // --- å¤©æ°—æ–‡å­—åˆ—ã¾ãŸã¯ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç°¡å˜ãªçµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿”ã™é–¢æ•° ---
        function getWeatherIcon(codeOrString) {
            if (!codeOrString) return 'â“'; // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
            const codeStr = String(codeOrString); // æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦æ‰±ã†

            // --- å¤©æ°—ã‚³ãƒ¼ãƒ‰ (æ•°å­—æ–‡å­—åˆ—) ã«ã‚ˆã‚‹åˆ¤å®šã‚’å„ªå…ˆ ---
            // isNaN(parseInt(codeStr)) === false ã§æ•°å­—ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
            if (!isNaN(parseInt(codeStr))) {
                const codeInt = parseInt(codeStr); // æ•´æ•°ã«å¤‰æ›

                // æ°—è±¡åºå¤©æ°—ã‚³ãƒ¼ãƒ‰ã®ãŠãŠã¾ã‹ãªåˆ†é¡ã«åŸºã¥ã„ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ
                if (codeInt >= 100 && codeInt < 200) { // 1xx: æ™´ã‚Œç³»
                if ([101, 110, 111].includes(codeInt)) return 'ğŸŒ¤ï¸'; // æ™´æ™‚ã€…æ›‡ãªã©
                if (codeInt >= 120 && codeInt <= 122) return 'ğŸŒ¦ï¸'; // æ™´æ™‚ã€…é›¨
                if (codeInt >= 123 && codeInt <= 128) return 'ğŸŒ§ï¸'; // æ™´ä¸€æ™‚é›¨/æš´é¢¨é›¨
                if (codeInt >= 130 && codeInt <= 132) return 'ğŸŒ¨ï¸'; // æ™´ä¸€æ™‚é›ª
                if (codeInt >= 160 && codeInt <= 170) return 'â„ï¸'; // æ™´å¾Œé›ªãªã©
                if (codeInt >= 181) return 'ğŸŒ¨ï¸'; // æ™´å¾Œé›ª(é¢¨é›ªå¼·ã„)
                return 'â˜€ï¸'; // å¿«æ™´ãªã©ä¸Šè¨˜ä»¥å¤–
            } else if (codeInt >= 200 && codeInt < 300) { // 2xx: ãã‚‚ã‚Šç³»
                if ([201, 210, 211].includes(codeInt)) return 'ğŸŒ¥ï¸'; // æ›‡æ™‚ã€…æ™´ãªã©
                if (codeInt >= 220 && codeInt <= 222) return 'ğŸŒ¦ï¸'; // æ›‡æ™‚ã€…é›¨
                if (codeInt >= 223 && codeInt <= 231) return 'ğŸŒ§ï¸'; // æ›‡ä¸€æ™‚é›¨/é›¨
                if (codeInt >= 240 && codeInt <= 250) return 'ğŸŒ¨ï¸'; // æ›‡ä¸€æ™‚é›ª/é›ª
                if (codeInt >= 260 && codeInt <= 270) return 'â„ï¸'; // æ›‡å¾Œé›ªãªã©
                if (codeInt >= 281) return 'ğŸŒ¨ï¸'; // æ›‡å¾Œé›ª(é¢¨é›ªå¼·ã„)
                return 'â˜ï¸'; // æ›‡ã‚Šãªã©ä¸Šè¨˜ä»¥å¤–
            } else if (codeInt >= 300 && codeInt < 400) { // 3xx: é›¨ç³»
                if ([301, 302, 311, 313, 303, 309, 328, 329].includes(codeInt)) return 'ğŸŒ¦ï¸'; // é›¨æ™‚ã€…æ™´/æ›‡ã€é›¨å¾Œæ™´/æ›‡ãªã©
                if ([314, 315, 320, 321].includes(codeInt)) return 'ğŸŒ¨ï¸'; // é›¨å¾Œé›ªãªã©
                if ([323, 324, 325, 326, 327, 340, 350, 361, 371].includes(codeInt)) return 'ğŸŒ§ï¸'; // é›¨é›ªæ··ã˜ã‚Šã€ã¿ãã‚Œãªã©
                return 'â˜”'; // é›¨ (300ãªã©)
            } else if (codeInt >= 400 && codeInt < 500) { // 4xx: é›ªç³»
                if ([401, 402, 411, 413, 403, 405, 406, 407, 409, 425, 426, 427].includes(codeInt)) return 'ğŸŒ¨ï¸'; // é›ªæ™‚ã€…æ™´/æ›‡ã€é›ªå¾Œæ™´/æ›‡ãªã©
                if ([414, 420, 421].includes(codeInt)) return 'ğŸŒ§ï¸'; // é›ªå¾Œé›¨ãªã©
                if ([422, 423, 450].includes(codeInt)) return 'â„ï¸'; // å¹é›ªãªã©
                return 'â„ï¸'; // é›ª (400ãªã©)
            }
            // ä»–ã«ã‚‚æš´é¢¨åŸŸ(5xx)ã€éœ§(6xx)ã€ç…™éœ§(7xx)ãªã©ãŒã‚ã‚Šã¾ã™ãŒã€ä¸»è¦ãªã‚‚ã®ã‚’ã‚«ãƒãƒ¼
            log.warn(`æœªå¯¾å¿œã®å¤©æ°—ã‚³ãƒ¼ãƒ‰: ${codeInt}`); // æœªå¯¾å¿œã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°ãƒ­ã‚°å‡ºåŠ›
            return 'â“'; // ä¸æ˜ãªã‚³ãƒ¼ãƒ‰
        }

            // --- ã‚³ãƒ¼ãƒ‰ã§åˆ¤å®šã§ããªã‹ã£ãŸå ´åˆã€æ–‡å­—åˆ—ã§åˆ¤å®š (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯) ---
            if (codeOrString.includes('æ™´ã‚Œ')) { if (codeOrString.includes('ãã‚‚ã‚Š') || codeOrString.includes('æ›‡ã‚Š')) return 'ğŸŒ¤ï¸'; return 'â˜€ï¸'; }
            if (codeOrString.includes('é›¨')) { if (codeOrString.includes('ãã‚‚ã‚Š') || codeOrString.includes('æ›‡ã‚Š')) return 'ğŸŒ¦ï¸'; if (codeOrString.includes('é›ª')) return 'ğŸŒ¨ï¸'; return 'ğŸŒ§ï¸'; }
            if (codeOrString.includes('ãã‚‚ã‚Š') || codeOrString.includes('æ›‡ã‚Š')) { return 'â˜ï¸'; }
            if (codeOrString.includes('é›ª')) { return 'â„ï¸'; }
            if (codeOrString.includes('é›·')) { return 'âš¡'; }

            log.warn(`ä¸æ˜ãªå¤©æ°—æƒ…å ±: ${codeOrString}`);
            return 'â“'; // ãã‚Œã§ã‚‚ä¸æ˜ãªå ´åˆ
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        fetchWeather();
    </script>

</body>
</html>